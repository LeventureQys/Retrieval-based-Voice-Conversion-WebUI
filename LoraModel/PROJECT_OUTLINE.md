# RVC-LoRA é¡¹ç›®å¤§çº²

## é¡¹ç›®ç›®æ ‡
ä¸º RVC (Retrieval-based Voice Conversion) æ·»åŠ  LoRA (Low-Rank Adaptation) æ”¯æŒï¼Œå®ç°ï¼š
- å¤§å¹…å‡å°‘æ¨¡å‹å­˜å‚¨ç©ºé—´ï¼ˆèŠ‚çœ 89%ï¼‰
- åŠ é€Ÿè®­ç»ƒè¿‡ç¨‹ï¼ˆå‡å°‘ 40-50% è®­ç»ƒæ—¶é—´ï¼‰
- æ”¯æŒå¿«é€Ÿè®­ç»ƒå¤šä¸ªå£°éŸ³æ¨¡å‹
- ä¿æŒé«˜è´¨é‡ï¼ˆ95-98% çš„å®Œæ•´å¾®è°ƒè´¨é‡ï¼‰

## é¡¹ç›®ç»“æ„

```
LoraModel/
â”œâ”€â”€ PROJECT_OUTLINE.md          # é¡¹ç›®å¤§çº²ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ PROGRESS.md                 # è¿›åº¦è¿½è¸ªæ–‡æ¡£
â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ requirements.txt            # ä¾èµ–åˆ—è¡¨
â”‚
â”œâ”€â”€ docs/                       # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ phase1_lora_core.md    # é˜¶æ®µ1ï¼šLoRAæ ¸å¿ƒå®ç°æ–‡æ¡£
â”‚   â”œâ”€â”€ phase2_model_integration.md  # é˜¶æ®µ2ï¼šæ¨¡å‹é›†æˆæ–‡æ¡£
â”‚   â”œâ”€â”€ phase3_training.md     # é˜¶æ®µ3ï¼šè®­ç»ƒæµç¨‹æ–‡æ¡£
â”‚   â”œâ”€â”€ phase4_inference.md    # é˜¶æ®µ4ï¼šæ¨ç†å®ç°æ–‡æ¡£
â”‚   â””â”€â”€ phase5_testing.md      # é˜¶æ®µ5ï¼šæµ‹è¯•éªŒè¯æ–‡æ¡£
â”‚
â”œâ”€â”€ lora/                       # LoRA æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ lora_layer.py          # LoRA å±‚å®ç°
â”‚   â”œâ”€â”€ lora_utils.py          # LoRA å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ lora_config.py         # LoRA é…ç½®
â”‚
â”œâ”€â”€ models/                     # æ¨¡å‹ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ generator_lora.py      # å¸¦ LoRA çš„ç”Ÿæˆå™¨
â”‚   â”œâ”€â”€ synthesizer_lora.py    # å¸¦ LoRA çš„åˆæˆå™¨
â”‚   â””â”€â”€ model_utils.py         # æ¨¡å‹å·¥å…·å‡½æ•°
â”‚
â”œâ”€â”€ training/                   # è®­ç»ƒä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ train_lora.py          # LoRA è®­ç»ƒè„šæœ¬
â”‚   â”œâ”€â”€ data_loader.py         # æ•°æ®åŠ è½½å™¨
â”‚   â””â”€â”€ losses.py              # æŸå¤±å‡½æ•°
â”‚
â”œâ”€â”€ inference/                  # æ¨ç†ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ infer_lora.py          # LoRA æ¨ç†è„šæœ¬
â”‚   â””â”€â”€ model_loader.py        # æ¨¡å‹åŠ è½½å™¨
â”‚
â”œâ”€â”€ tests/                      # æµ‹è¯•ä»£ç 
â”‚   â”œâ”€â”€ test_lora_layer.py
â”‚   â”œâ”€â”€ test_model.py
â”‚   â”œâ”€â”€ test_training.py
â”‚   â””â”€â”€ test_inference.py
â”‚
â”œâ”€â”€ examples/                   # ç¤ºä¾‹ä»£ç 
â”‚   â”œâ”€â”€ train_example.py       # è®­ç»ƒç¤ºä¾‹
â”‚   â””â”€â”€ infer_example.py       # æ¨ç†ç¤ºä¾‹
â”‚
â””â”€â”€ scripts/                    # è¾…åŠ©è„šæœ¬
    â”œâ”€â”€ prepare_data.sh        # æ•°æ®å‡†å¤‡è„šæœ¬
    â”œâ”€â”€ convert_model.py       # æ¨¡å‹è½¬æ¢è„šæœ¬
    â””â”€â”€ merge_lora.py          # LoRA åˆå¹¶è„šæœ¬
```

## å¼€å‘é˜¶æ®µ

### é˜¶æ®µ 1: LoRA æ ¸å¿ƒå®ç° â³
**ç›®æ ‡**: å®ç° LoRA å±‚å’ŒåŸºç¡€å·¥å…·å‡½æ•°
**æ—¶é—´**: 2-3 å¤©
**çŠ¶æ€**: ğŸ”„ è¿›è¡Œä¸­

**ä»»åŠ¡æ¸…å•**:
- [ ] åˆ›å»ºé¡¹ç›®ç»“æ„
- [ ] å®ç° LoRA å±‚ç±» (LoRALayer)
- [ ] å®ç° LoRA çº¿æ€§å±‚ (LoRALinear)
- [ ] å®ç° LoRA å·ç§¯å±‚ (LoRAConv1d, LoRAConvTranspose1d)
- [ ] å®ç° LoRA å·¥å…·å‡½æ•°ï¼ˆæ³¨å…¥ã€æå–ã€åˆå¹¶ï¼‰
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•
- [ ] ç¼–å†™é˜¶æ®µæ–‡æ¡£

**äº¤ä»˜ç‰©**:
- lora/lora_layer.py
- lora/lora_utils.py
- lora/lora_config.py
- tests/test_lora_layer.py
- docs/phase1_lora_core.md

---

### é˜¶æ®µ 2: æ¨¡å‹é›†æˆ â¸ï¸
**ç›®æ ‡**: å°† LoRA é›†æˆåˆ° RVC ç”Ÿæˆå™¨ä¸­
**æ—¶é—´**: 2-3 å¤©
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

**ä»»åŠ¡æ¸…å•**:
- [ ] å¤åˆ¶åŸå§‹ Generator ä»£ç 
- [ ] åˆ›å»º GeneratorLoRA ç±»
- [ ] åœ¨ä¸Šé‡‡æ ·å±‚æ·»åŠ  LoRA
- [ ] åœ¨ ResBlock æ·»åŠ  LoRA
- [ ] å¤„ç† weight_norm å…¼å®¹æ€§
- [ ] å®ç°å‚æ•°å†»ç»“/è§£å†»
- [ ] æµ‹è¯•å‰å‘ä¼ æ’­
- [ ] ç¼–å†™é˜¶æ®µæ–‡æ¡£

**äº¤ä»˜ç‰©**:
- models/generator_lora.py
- models/synthesizer_lora.py
- tests/test_model.py
- docs/phase2_model_integration.md

---

### é˜¶æ®µ 3: è®­ç»ƒæµç¨‹ â¸ï¸
**ç›®æ ‡**: å®ç° LoRA è®­ç»ƒè„šæœ¬
**æ—¶é—´**: 3-4 å¤©
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

**ä»»åŠ¡æ¸…å•**:
- [ ] å¤åˆ¶åŸå§‹è®­ç»ƒä»£ç 
- [ ] ä¿®æ”¹è®­ç»ƒå¾ªç¯æ”¯æŒ LoRA
- [ ] å®ç°åº•æ¨¡åŠ è½½å’Œå‚æ•°å†»ç»“
- [ ] å®ç° LoRA å‚æ•°ä¿å­˜/åŠ è½½
- [ ] å®ç°è®­ç»ƒé…ç½®
- [ ] æ·»åŠ è®­ç»ƒæ—¥å¿—å’Œç›‘æ§
- [ ] æµ‹è¯•è®­ç»ƒæµç¨‹
- [ ] ç¼–å†™é˜¶æ®µæ–‡æ¡£

**äº¤ä»˜ç‰©**:
- training/train_lora.py
- training/data_loader.py
- tests/test_training.py
- docs/phase3_training.md

---

### é˜¶æ®µ 4: æ¨ç†å®ç° â¸ï¸
**ç›®æ ‡**: å®ç° LoRA æ¨ç†åŠŸèƒ½
**æ—¶é—´**: 2-3 å¤©
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

**ä»»åŠ¡æ¸…å•**:
- [ ] å®ç°åº•æ¨¡+LoRAåŠ è½½å™¨
- [ ] å®ç°æ¨ç†è„šæœ¬
- [ ] æ”¯æŒå®æ—¶æ¨ç†
- [ ] å‘åå…¼å®¹å®Œæ•´æ¨¡å‹
- [ ] å®ç° LoRA åˆå¹¶åŠŸèƒ½
- [ ] æµ‹è¯•æ¨ç†è´¨é‡
- [ ] ç¼–å†™é˜¶æ®µæ–‡æ¡£

**äº¤ä»˜ç‰©**:
- inference/infer_lora.py
- inference/model_loader.py
- scripts/merge_lora.py
- tests/test_inference.py
- docs/phase4_inference.md

---

### é˜¶æ®µ 5: æµ‹è¯•å’ŒéªŒè¯ â¸ï¸
**ç›®æ ‡**: å…¨é¢æµ‹è¯•å’Œæ€§èƒ½éªŒè¯
**æ—¶é—´**: 2-3 å¤©
**çŠ¶æ€**: â¸ï¸ å¾…å¼€å§‹

**ä»»åŠ¡æ¸…å•**:
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] è´¨é‡å¯¹æ¯”æµ‹è¯•
- [ ] å­˜å‚¨ç©ºé—´éªŒè¯
- [ ] è®­ç»ƒæ—¶é—´éªŒè¯
- [ ] ç¼–å†™ä½¿ç”¨æ–‡æ¡£
- [ ] ç¼–å†™é˜¶æ®µæ–‡æ¡£

**äº¤ä»˜ç‰©**:
- examples/train_example.py
- examples/infer_example.py
- docs/phase5_testing.md
- README.md (å®Œæ•´ç‰ˆ)

---

## æŠ€æœ¯è§„æ ¼

### LoRA é…ç½®

| å±‚ç±»å‹ | Rank | Alpha | å‚æ•°é‡ | ä¼˜å…ˆçº§ |
|--------|------|-------|--------|--------|
| ä¸Šé‡‡æ ·å±‚ (ups) | 8-16 | 16-32 | ~80K | â­â­â­ |
| ResBlock å·ç§¯ | 4-8 | 8-16 | ~240K | â­â­â­ |
| TextEncoder æ³¨æ„åŠ› | 4-8 | 8-16 | ~55K | â­â­ |
| Speaker Embedding | 4 | 8 | ~12K | â­ |

**æ€» LoRA å‚æ•°**: ~387K (åŸæ¨¡å‹çš„ 3.1%)

### é¢„æœŸæ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å®Œæ•´å¾®è°ƒ | LoRA |
|-----|---------|------|
| æ¨¡å‹å¤§å° | 55 MB | åº•æ¨¡ 55MB + LoRA 387KB |
| è®­ç»ƒæ—¶é—´ | 100% | 50-60% |
| è´¨é‡ | 100% | 95-98% |
| 10ä¸ªæ¨¡å‹å­˜å‚¨ | 550 MB | 58.87 MB |

### å…¼å®¹æ€§è¦æ±‚

- Python 3.8+
- PyTorch 1.13+
- å‘åå…¼å®¹åŸå§‹ RVC æ¨¡å‹
- æ”¯æŒ CPU å’Œ GPU è®­ç»ƒ/æ¨ç†

---

## ä¾èµ–é¡¹

```
torch>=1.13.0
numpy>=1.23.0
scipy
librosa==0.9.1
fairseq==0.12.2
gradio==3.34.0
tensorboard
tqdm
```

---

## ä½¿ç”¨æµç¨‹

### è®­ç»ƒæµç¨‹
```bash
# 1. å‡†å¤‡æ•°æ®
python scripts/prepare_data.py --input_dir ./data/raw --output_dir ./data/processed

# 2. è®­ç»ƒ LoRA
python training/train_lora.py \
    --base_model ./pretrained/G40k.pth \
    --data_dir ./data/processed \
    --output_dir ./output \
    --lora_rank 8 \
    --epochs 100

# 3. åˆå¹¶ LoRAï¼ˆå¯é€‰ï¼‰
python scripts/merge_lora.py \
    --base_model ./pretrained/G40k.pth \
    --lora_weights ./output/lora.pth \
    --output ./output/merged.pth
```

### æ¨ç†æµç¨‹
```bash
# ä½¿ç”¨ LoRA æ¨ç†
python inference/infer_lora.py \
    --base_model ./pretrained/G40k.pth \
    --lora_weights ./output/lora.pth \
    --input ./input.wav \
    --output ./output.wav

# æˆ–ä½¿ç”¨åˆå¹¶åçš„æ¨¡å‹
python inference/infer_lora.py \
    --model ./output/merged.pth \
    --input ./input.wav \
    --output ./output.wav
```

---

## å¼€å‘è§„èŒƒ

### ä»£ç é£æ ¼
- éµå¾ª PEP 8
- ä½¿ç”¨ç±»å‹æ³¨è§£
- æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²
- æ¯ä¸ªå‡½æ•°éƒ½æœ‰å•å…ƒæµ‹è¯•

### Git æäº¤è§„èŒƒ
```
feat: æ·»åŠ æ–°åŠŸèƒ½
fix: ä¿®å¤bug
docs: æ–‡æ¡£æ›´æ–°
test: æµ‹è¯•ç›¸å…³
refactor: ä»£ç é‡æ„
```

### æ–‡æ¡£è§„èŒƒ
- æ¯ä¸ªé˜¶æ®µå®Œæˆåæ›´æ–° PROGRESS.md
- æ¯ä¸ªé˜¶æ®µéƒ½æœ‰è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£
- ä»£ç ä¸­æ·»åŠ å……åˆ†çš„æ³¨é‡Š
- æä¾›ä½¿ç”¨ç¤ºä¾‹

---

## é£é™©å’ŒæŒ‘æˆ˜

### æŠ€æœ¯é£é™©
1. **Weight Norm å…¼å®¹æ€§** - éœ€è¦ç‰¹æ®Šå¤„ç†
2. **è®­ç»ƒç¨³å®šæ€§** - LoRA rank å’Œå­¦ä¹ ç‡éœ€è¦è°ƒä¼˜
3. **è´¨é‡æŸå¤±** - å¯èƒ½æœ‰ 2-5% çš„è´¨é‡ä¸‹é™

### ç¼“è§£æªæ–½
1. å®ç° weight_norm çš„ç‰¹æ®Šå¤„ç†é€»è¾‘
2. æä¾›å¤šç»„è¶…å‚æ•°é…ç½®
3. å®ç°è´¨é‡ç›‘æ§å’Œå¯¹æ¯”å·¥å…·

---

## é‡Œç¨‹ç¢‘

- [x] é¡¹ç›®å¯åŠ¨å’Œè§„åˆ’ (2026-01-28)
- [ ] é˜¶æ®µ1å®Œæˆ (é¢„è®¡ 2026-01-30)
- [ ] é˜¶æ®µ2å®Œæˆ (é¢„è®¡ 2026-02-02)
- [ ] é˜¶æ®µ3å®Œæˆ (é¢„è®¡ 2026-02-06)
- [ ] é˜¶æ®µ4å®Œæˆ (é¢„è®¡ 2026-02-09)
- [ ] é˜¶æ®µ5å®Œæˆ (é¢„è®¡ 2026-02-12)
- [ ] é¡¹ç›®å‘å¸ƒ (é¢„è®¡ 2026-02-15)

---

## è”ç³»å’Œæ”¯æŒ

- é¡¹ç›®ä½ç½®: `D:\Workshop\Retrieval-based-Voice-Conversion-WebUI\LoraModel`
- Conda ç¯å¢ƒ: `rvc`
- åŸå§‹ RVC é¡¹ç›®: https://github.com/RVC-Project/Retrieval-based-Voice-Conversion-WebUI

---

## æ›´æ–°æ—¥å¿—

### 2026-01-28
- åˆ›å»ºé¡¹ç›®ç»“æ„
- ç¼–å†™é¡¹ç›®å¤§çº²
- å¼€å§‹é˜¶æ®µ1å¼€å‘

---

**æ³¨æ„**: æœ¬é¡¹ç›®æ˜¯å¯¹åŸå§‹ RVC é¡¹ç›®çš„æ‰©å±•ï¼Œä¿æŒä¸åŸé¡¹ç›®çš„å…¼å®¹æ€§ã€‚
